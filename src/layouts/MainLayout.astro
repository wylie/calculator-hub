---
import '../index.css';
import Nav from '../components/Nav.astro';
import ConsentBanner from '../components/ConsentBanner.astro';

interface Props {
  title: string;
  description?: string;
  canonical?: string;
  image?: string;
  noindex?: boolean;
  jsonLd?: Record<string, unknown> | Array<Record<string, unknown>>;
}

const siteUrl = 'https://simplecalculators.io';
const siteName = 'Simple Calculators';
const { title, description, canonical, image, noindex = false, jsonLd } = Astro.props;
const canonicalUrl = canonical || `${siteUrl}${Astro.url.pathname}`;
const defaultDescription = 'Free online calculators and converters for mortgage, budget, weather, calories, and more. Simple, accurate, and easy to use.';
const pageDescription = description || defaultDescription;
const pageTitle = `${title} | ${siteName}`;
const ogSlug = Astro.url.pathname === '/' ? 'home' : Astro.url.pathname.replace(/^\//, '').replace(/\/$/, '');
const ogImage = image || `${siteUrl}/og/${ogSlug}.svg`;
const isToolPage = /calculator|converter/i.test(title);
const breadcrumbItems = Astro.url.pathname === '/'
  ? [{ '@type': 'ListItem', position: 1, name: 'Home', item: `${siteUrl}/` }]
  : [
      { '@type': 'ListItem', position: 1, name: 'Home', item: `${siteUrl}/` },
      { '@type': 'ListItem', position: 2, name: title, item: canonicalUrl },
    ];

const baseJsonLd: Array<Record<string, unknown>> = [
  {
    '@context': 'https://schema.org',
    '@type': 'WebSite',
    name: siteName,
    url: `${siteUrl}/`,
    potentialAction: {
      '@type': 'SearchAction',
      target: `${siteUrl}/?q={search_term_string}`,
      'query-input': 'required name=search_term_string',
    },
  },
  {
    '@context': 'https://schema.org',
    '@type': 'WebPage',
    name: pageTitle,
    description: pageDescription,
    url: canonicalUrl,
    isPartOf: {
      '@type': 'WebSite',
      name: siteName,
      url: `${siteUrl}/`,
    },
  },
  {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: breadcrumbItems,
  },
];

if (isToolPage) {
  baseJsonLd.push({
    '@context': 'https://schema.org',
    '@type': 'SoftwareApplication',
    name: title,
    applicationCategory: title.toLowerCase().includes('converter') ? 'UtilitiesApplication' : 'FinanceApplication',
    operatingSystem: 'Any',
    isAccessibleForFree: true,
    url: canonicalUrl,
    offers: {
      '@type': 'Offer',
      price: '0',
      priceCurrency: 'USD',
    },
  });

  baseJsonLd.push({
    '@context': 'https://schema.org',
    '@type': 'TechArticle',
    headline: title,
    description: pageDescription,
    author: {
      '@type': 'Organization',
      name: siteName,
    },
    publisher: {
      '@type': 'Organization',
      name: siteName,
    },
    dateModified: '2026-02-18',
    mainEntityOfPage: canonicalUrl,
  });
}

const pageJsonLd = jsonLd ? (Array.isArray(jsonLd) ? jsonLd : [jsonLd]) : [];
const allJsonLd = [...baseJsonLd, ...pageJsonLd];
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{pageTitle}</title>
    <meta name="description" content={pageDescription} />
    {noindex && <meta name="robots" content="noindex,nofollow" />}
    <link rel="canonical" href={canonicalUrl} />

    <meta property="og:type" content="website" />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:title" content={pageTitle} />
    <meta property="og:description" content={pageDescription} />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:image" content={ogImage} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={pageTitle} />
    <meta name="twitter:description" content={pageDescription} />
    <meta name="twitter:image" content={ogImage} />
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    
    <!-- Google Material Symbols -->
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
      rel="stylesheet"
    />
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1766867001144344" crossorigin="anonymous"></script>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7Z9DM31C5W"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7Z9DM31C5W');
    </script>

    {allJsonLd.map((schema) => (
      <script type="application/ld+json" set:html={JSON.stringify(schema)} />
    ))}
  </head>
  <body>
    <div class="flex flex-col min-h-screen bg-slate-50">
      <header>
        <Nav />
      </header>
      <main class="flex-1 max-w-4xl w-full mx-auto px-4 py-8">
        <slot />
      </main>
      <ConsentBanner />
      <footer class="border-t border-slate-200 bg-white py-6 mt-12">
        <div class="max-w-4xl mx-auto px-4 text-center text-xs text-slate-600">
          <p class="mb-2">
            Disclaimer: These calculators provide estimates for educational purposes only. They are not
            financial or medical advice. Please consult with a qualified professional for
            personalized guidance.
          </p>
          <div class="flex flex-wrap items-center justify-center gap-3 mb-2">
            <a href="/privacy" class="text-xs text-slate-600 hover:text-slate-900 underline">Privacy Policy</a>
            <a href="/terms" class="text-xs text-slate-600 hover:text-slate-900 underline">Terms</a>
            <a href="/accessibility" class="text-xs text-slate-600 hover:text-slate-900 underline">Accessibility</a>
            <a href="/contact" class="text-xs text-slate-600 hover:text-slate-900 underline">Contact</a>
          </div>
          <p>Simple Calculators 2026. All rights reserved.</p>
        </div>
      </footer>
    </div>
  </body>
</html>
